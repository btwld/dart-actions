name: "Pull-Request Title Check"

on:
  workflow_call:
    inputs:
      comment_header:
        description: "Header used for the sticky PR comment"
        required: false
        default: pr-title-lint-error
        type: string
      comment_message:
        description: "Message shown when PR title is invalid"
        required: false
        default: |
          Hey there and thank you for opening this pull request! üëãüèº

          We require pull request titles to follow the [Conventional Commits specification](https://www.conventionalcommits.org/en/v1.0.0/)
          and it looks like your proposed title needs to be adjusted.

          Details:

          ```
          ${{ steps.lint_pr_title.outputs.error_message }}
          ```
        type: string

jobs:
  main:
    name: Validate PR title
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write

    steps:
      - uses: amannn/action-semantic-pull-request@v5.5.3
        id: lint_pr_title
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Add PR comment for invalid title
        if: always() && (steps.lint_pr_title.outputs.error_message != null)
        uses: marocchino/sticky-pull-request-comment@v2
        with:
          header: ${{ inputs.comment_header }}
          message: ${{ inputs.comment_message }}

      - name: Remove comment if title is fixed
        if: ${{ steps.lint_pr_title.outputs.error_message == null }}
        uses: marocchino/sticky-pull-request-comment@v2
        with:
          header: ${{ inputs.comment_header }}
          delete: true